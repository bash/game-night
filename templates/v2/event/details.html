{% extends "base.html" %}

{% block page_title %}
    {% if !event.title.is_empty() %}
        Tau's Game Night ¬´{{event.title}}¬ª
    {% else %}
        Tau's Game Night
    {% endif %}
{% endblock %}

{% block title %}Play{% endblock title %}

{% macro event_details() %}
    {% if !event.title.is_empty() %}
        <h2>{{ LongEventTitleComponent::for_event(event) | safe }}</h2>
    {% endif %}

    <p>
        {{ UserNameComponent::for_user(event.created_by) | safe }} is organizing a <em>game night</em>
        on <strong>{{event.starts_at | time("{date}")}}</strong> at
        <strong>{{event.starts_at | time("{time}")}}</strong>
        and you're invited ü•≥
    </p>

    {% if let Some(group) = event.restrict_to %}
    <p>
        This is a special game night just for members of
        <strong>¬´{{group.name}}¬ª</strong>.
    </p>
    {% endif %}

    <fieldset>
        <a class="link-button" href="{{ics_uri}}" download="game-night-{{event.id}}">Save to Calendar</a>
    </fieldset>

    {% if let Some(leave_uri) = leave_uri %}
        <section>
            <h2>Can't make it?</h2>
            <p>
                <a href="{{leave_uri}}">Leave</a> this event to
                communicate your absence to {{ UserNameComponent::for_user(event.created_by) | safe }}.
            </p>
        </section>
    {% endif %}

    <section>
        <h2>What?</h2>
        {{event.description | markdown | safe}}
    </section>

    <section>
        <h2>When?</h2>
        <p>
            On <strong>{{event.starts_at | time("{date}")}}</strong>
            at <time>{{event.starts_at | time("{time}")}}</time>.
        </p>
    </section>

    <section>
        <h2>Where?</h2>
        {{ PostalAddressComponent::for_location(event.location) | safe }}
    </section>

    <section>
        <h2>Who?</h2>
        <ul class="users-list">
            {% for participant in participants.participants %}
                <li>
                    {{ UserNameComponent::for_user(participant.user).with_symbol() | safe }}
                    {% if participant.user.id == user.id %}
                        <small><strong>‚Üê this is you!</strong></small>
                    {% endif %}
                </li>
            {% endfor %}
            {% if participants.redacted %}
                <li>&hellip;</li>
            {% endif %}
        </ul>
    </section>
{% endmacro %}

{% block content %}
    {% if let Some(join_uri) = join_uri %}
        <p>
            Hey there <strong>{{user.name}}</strong>, it looks like you missed the poll.
            No problem! You can still join us :)
        </p>

        <form>
            <fieldset>
                <button type="submit" formmethod="post" formaction="{{join_uri}}">Join</button>
            </fieldset>
        </form>

        <div class="preview-box">
            <h2>Preview</h2>

            <div class="content">
                {% call event_details %}}
            </div>
        </div>
    {% else %}
        {% match stage %}
        {% when PlayPageStage::Planned %}
        {% when PlayPageStage::Archived %}
            <p class="message-box"><strong>Careful:</strong> You're viewing a game night that's in the past.</p>
        {% when PlayPageStage::Cancelled %}
            <p class="message-box"><strong>Important:</strong> This game night has been cancelled.</p>
        {% endmatch %}
        {% call event_details %}
    {% endif %}

    <hr>

    <p>
        Check out the <a href="{{uri.archive_page()}}">archive</a> to see a list of all past game nights.
    </p>
{% endblock content %}
